<!DOCTYPE html>
<html>
<head>
    <title>hadichm</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { background-color: #0b141a; color: #e9edef; font-family: sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; }
        
        /* Login Screen */
        #login { position: fixed; inset: 0; background: #0b141a; display: flex; align-items: center; justify-content: center; z-index: 1000; flex-direction: column; }
        input { background: #2a3942; border: none; padding: 15px; color: white; border-radius: 10px; outline: none; margin: 10px; }
        button { background: #00a884; border: none; padding: 15px 30px; border-radius: 10px; font-weight: bold; cursor: pointer; }

        /* Chat Layout */
        #header { background: #202c33; padding: 15px; text-align: center; color: #00a884; font-weight: bold; }
        #chat-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-blend-mode: overlay; }
        
        .msg { max-width: 70%; padding: 10px; margin: 5px 0; border-radius: 10px; word-wrap: break-word; }
        .sent { align-self: flex-end; background: #005c4b; }
        .rcvd { align-self: flex-start; background: #202c33; }

        /* FIXED TYPING INDICATOR */
        #typing-box { align-self: flex-start; color: #00a884; font-size: 13px; margin: 5px; display: none; }

        #input-bar { background: #202c33; padding: 15px; display: flex; }
        #message-input { flex: 1; }
    </style>
</head>
<body>

<div id="login">
    <h1>HADICHM</h1>
    <input type="password" id="pass" placeholder="Passcode">
    <button onclick="enter()">CONNECT</button>
</div>

<div id="header">PRIVATE TUNNEL</div>

<div id="chat-area">
    <div id="typing-box">typing...</div>
</div>

<div id="input-bar">
    <input type="text" id="message-input" placeholder="Type a message" oninput="sendTyping()">
    <button onclick="sendMsg()">SEND</button>
</div>

<script>
    // YOUR ORIGINAL FIREBASE CONFIG
    const firebaseConfig = {
        databaseURL: "YOUR_FIREBASE_URL_HERE" // Paste your actual URL here
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // LOGIN
    function enter() {
        let p = document.getElementById('pass').value;
        if(p.toLowerCase() === 'hadi' || p.toLowerCase() === 'abdullah') {
            document.getElementById('login').style.display = 'none';
        } else { alert('Wrong code'); }
    }

    // TYPING LOGIC (FIXED)
    function sendTyping() {
        db.ref('status/').set({ typing: true });
        setTimeout(() => db.ref('status/').set({ typing: false }), 2000);
    }

    db.ref('status/').on('value', (snap) => {
        const tBox = document.getElementById('typing-box');
        const chat = document.getElementById('chat-area');
        if(snap.val().typing) {
            tBox.style.display = 'block';
            chat.scrollTop = chat.scrollHeight; // Auto-scroll to show typing
        } else {
            tBox.style.display = 'none';
        }
    });

    // MESSAGE LOGIC
    function sendMsg() {
        let text = document.getElementById('message-input').value;
        if(text) {
            db.ref('messages/').push({ text: text, user: 'hadi' });
            document.getElementById('message-input').value = '';
        }
    }

    db.ref('messages/').on('child_added', (snap) => {
        let data = snap.val();
        let div = document.createElement('div');
        div.classList.add('msg');
        div.classList.add(data.user === 'hadi' ? 'sent' : 'rcvd');
        div.innerText = data.text;
        
        // Insert BEFORE typing box
        let chat = document.getElementById('chat-area');
        let tBox = document.getElementById('typing-box');
        chat.insertBefore(div, tBox);
        chat.scrollTop = chat.scrollHeight;
    });
</script>

</body>
</html>
